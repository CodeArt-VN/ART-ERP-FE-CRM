<ion-header>
	<app-toolbar [page]="this"></app-toolbar>
</ion-header>
<ion-content appScrollbarTheme class="header-table">
	<app-page-title class="ion-padding safe-max-width" [pageConfig]="pageConfig"></app-page-title>

	<ion-fab *ngIf="pageConfig.isShowFeature && pageConfig.canMerge " class="feature" vertical="top" horizontal="end"
		slot="fixed">
		<div>
			<ion-list-header lines="full">
				<ion-label>{{'Find duplicates' | translate}}</ion-label>
			</ion-list-header>

			<ion-radio-group (ionChange)="changeDuplicateKeywork($event)" [value]="'WorkPhone'">
				<ion-item>
					<ion-radio slot="start" aria-label="Danger" [value]="'WorkPhone'" color="primary" class="radio-icon"
						mode="md"></ion-radio>
					<ion-label style="white-space: normal">{{'WorkPhone' | translate}}</ion-label>
				</ion-item>
				<ion-item>
					<ion-radio slot="start" aria-label="Danger" [value]="'TaxCode'" color="primary" class="radio-icon"
						mode="md"></ion-radio>
					<ion-label style="white-space: normal">{{'TaxCode' | translate}}</ion-label>
				</ion-item>
			</ion-radio-group>
			<div class="ion-padding">
				<ion-button (click)="findByDuplicate()" expand="block">{{'Find...'| translate}}</ion-button>
			</div>

			<ion-list-header lines="full" *ngIf="mergeFunction.items.length">
				<ion-label>{{'Duplicate contacts' | translate}}</ion-label>
			</ion-list-header>

			<app-page-message [itemsLength]="mergeFunction.items.length"
				[showSpinner]="mergeFunction.showSpinner"></app-page-message>

			<ion-list *ngIf="mergeFunction.items.length && mergeFunction.showSpinner==false">
				<ion-item lines="full" *ngFor="let i of mergeFunction.items">
					<ion-icon size="small" slot="start" name="search"></ion-icon>
					<ion-label *ngIf="findByValue=='TaxCode'" clickable
						(click)="query.TaxCode_eq=i.Value;refresh()">{{i.Value}}</ion-label>
					<ion-label *ngIf="findByValue=='WorkPhone'" clickable
						(click)="query.WorkPhone_eq=i.Value;refresh()">{{i.Value}}</ion-label>
					<ion-note color="primary">{{i.Count}}</ion-note>
				</ion-item>
			</ion-list>
		</div>
	</ion-fab>


	<div class="safe-max-width" *ngIf="items.length && pageConfig.showSpinner==false">
		<app-data-table class="box-shadow responsive" [rows]="items" [trackBy]="'Id'" [(selectedRows)]="selectedItems"
			[showSpinner]="pageConfig.showSpinner" [showFilter]="pageConfig.isShowSearch" [(query)]="query"
			(dataInfinite)="loadData($event)" (filter)="onDatatableFilter($event)" (sort)="onSort($event)"
			(selectedRowsChange)="showCommandBySelectedRows($event)">
			<datatable-column [checkbox]="true" name=""></datatable-column>
			<datatable-column class="col-id" name="#" property="Id" [navLink]="pageConfig.pageName"></datatable-column>
			<datatable-column class="col-icon large" name="" property="Id">
				<ng-template let-i="row" datatable-cell-template>
					<ion-icon class="min-btn" [color]="i.IsPersonal?'success':'warning'"
						[name]="i.IsPersonal?'person-outline':'business-outline'"></ion-icon>
				</ng-template>
			</datatable-column>
			<datatable-column class="col-name" name="Name" property="Name">
				<ng-template let-i="row" datatable-cell-template>
					<div [routerLink]="['/'+pageConfig.pageName+'/'+i.Id]">
						<a class="bold">
							<ion-text color="dark">{{i.Name}}</ion-text>
						</a>
						<div *ngIf="i.Remark">{{i.Remark}}</div>
					</div>
				</ng-template>
			</datatable-column>
			<datatable-column class="col-name" name="Telephone" property="WorkPhone">
			</datatable-column>
			<datatable-column class="col-id" name="abbreviation of outlet" property="Id">
				<ng-template let-i="row" datatable-cell-template>
					<ion-icon class="min-btn" *ngIf="i.IsOutlets" name="checkmark"></ion-icon>
				</ng-template>
			</datatable-column>
			<datatable-column class="col-id" name="abbreviation of storer" property="Id">
				<ng-template let-i="row" datatable-cell-template>
					<ion-icon class="min-btn" *ngIf="i.IsStorer" name="checkmark"></ion-icon>
				</ng-template>
			</datatable-column>
			<datatable-column class="col-id" name="abbreviation of vendor" property="Id">
				<ng-template let-i="row" datatable-cell-template>
					<ion-icon class="min-btn" *ngIf="i.IsVendor" name="checkmark"></ion-icon>
				</ng-template>
			</datatable-column>
			<datatable-column class="col-id" name="abbreviation of carrier" property="Id">
				<ng-template let-i="row" datatable-cell-template>
					<ion-icon class="min-btn" *ngIf="i.IsCarrier" name="checkmark"></ion-icon>
				</ng-template>
			</datatable-column>
			<datatable-column class="col-id" name="abbreviation of branch" property="Id">
				<ng-template let-i="row" datatable-cell-template>
					<ion-icon class="min-btn" *ngIf="i.IsBranch" name="checkmark"></ion-icon>
				</ng-template>
			</datatable-column>
			<datatable-column class="col-id" name="abbreviation of staff" property="Id">
				<ng-template let-i="row" datatable-cell-template>
					<ion-icon class="min-btn" *ngIf="i.IsStaff" name="checkmark"></ion-icon>
				</ng-template>
			</datatable-column>
			<datatable-column class="col-status" name="Status" property="Status" filterControlType="ng-select"
				[filterDataSource]="statusList">
				<ng-template let-i="row" datatable-cell-template>
					<ion-badge [color]="i.StatusColor" [title]="i.StatusText"> {{i.StatusText | translate}} </ion-badge>
				</ng-template>
			</datatable-column>

		</app-data-table>
	</div>

	<ion-modal #mergeModal [isOpen]="isShowMergePopup" class="modal90" (willDismiss)="isShowMergePopup = false; ">
		<ng-template>
			<ion-header>
				<ion-toolbar>
					<ion-buttons slot="start" class="ion-hide-sm-down_">
						<ion-button color="dark" class="ion-hide-sm-down"> {{'Merge contacts' | translate}}
						</ion-button>
					</ion-buttons>

					<ion-buttons slot="primary">
						<ion-button title="{{'Close' | translate}}" color="secondary" (click)="isShowMergePopup= false">
							<ion-icon slot="icon-only" name="close"></ion-icon>
						</ion-button>
					</ion-buttons>
				</ion-toolbar>
			</ion-header>
			<ion-content appScrollbarTheme class="scrollx">
				<ion-grid class="merge-modal">
					<ion-row>
						<ion-col size="2">
							<ion-row class="merge-row avatar"> </ion-row>
							<ion-row class="merge-row"> {{'Code' | translate}} </ion-row>
							<ion-row class="merge-row"> {{'Name' | translate}} </ion-row>
							<ion-row class="merge-row name"> {{'WorkPhone' | translate}} </ion-row>
							<ion-row class="merge-row"> {{'TaxCode' | translate}} </ion-row>
							<ion-row class="merge-row"> {{'BillingAddress' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'CompanyName' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'Email' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'IsPersonal' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'AddressLine 1' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'AddressLine 2' | translate}} </ion-row>
							<ion-row class="merge-row"> {{'Contact' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'Country' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'Phone 1' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'Phone 2' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'Ward' | translate}}</ion-row>
							<ion-row class="merge-row"> {{'Province' | translate}}</ion-row>
						</ion-col>
						<ion-col size="10" appScrollbarTheme class="scrollx inner-scroll"
							style="max-width: 1440px; margin: auto; width: 100%; position: sticky; left: 0">
							<ion-row class="merge-row">
								<ion-radio-group style="display: flex">
									<ion-item *ngFor="let select of selectedItems">
										<ion-avatar (click)="changeSelected(select)"
											[ngStyle]="{'border': select.Id == mergeModel.Id ? '2px solid blue' : ''}">
											<img src="https://ionicframework.com/docs/img/demos/avatar.svg" />
										</ion-avatar>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Code">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Code" [value]="select.Code">{{select.Code}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Name">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Name" [value]="select.Name">{{select.Name}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.WorkPhone">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.WorkPhone"
											[value]="select.WorkPhone">{{select.WorkPhone}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.TaxCode">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.TaxCode"
											[value]="select.TaxCode">{{select.TaxCode}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.BillingAddress">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.BillingAddress"
											[value]="select.BillingAddress">{{select.BillingAddress}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.CompanyName">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.CompanyName"
											[value]="select.CompanyName">{{select.CompanyName}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Email">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Email"
											[value]="select.Email">{{select.Email}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.IsPersonal">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio [value]="select.IsPersonal">{{select.IsPersonal? 'Cá nhân':'Tổ
											chức'}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Address.AddressLine1">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Addresses.length && select.Addresses[0].AddressLine1"
											[value]="select.Addresses[0].AddressLine1">{{select.Addresses[0].AddressLine1}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Address.AddressLine2">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Addresses.length && select.Addresses[0].AddressLine2"
											[value]="select.Addresses[0].AddressLine2">{{select.Addresses[0].AddressLine2}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Address.Contact">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Addresses.length && select.Addresses[0].Contact"
											[value]="select.Addresses[0].Contact">{{select.Addresses[0].Contact}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Address.Country">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Addresses.length && select.Addresses[0].Country"
											[value]="select.Addresses[0].Country">{{select.Addresses[0].Country}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Address.Phone1">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Addresses.length && select.Addresses[0].Phone1"
											[value]="select.Addresses[0].Phone1">{{select.Addresses[0].Phone1}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Address.Phone2">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Addresses.length && select.Addresses[0].Phone2"
											[value]="select.Addresses[0].Phone2">{{select.Addresses[0].Province}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Address.Ward">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Addresses.length && select.Addresses[0].Ward"
											[value]="select.Addresses[0].Ward">{{select.Addresses[0].Ward}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
							<ion-row class="merge-row">
								<ion-radio-group [(ngModel)]="mergeModel.Address.Province">
									<ion-item lines="none" *ngFor="let select of selectedItems">
										<ion-radio *ngIf="select.Addresses.length && select.Addresses[0].Province"
											[value]="select.Addresses[0].Province">{{select.Addresses[0].Ward}}</ion-radio>
									</ion-item>
								</ion-radio-group>
							</ion-row>
						</ion-col>
					</ion-row>
				</ion-grid>
			</ion-content>
			<ion-footer>
				<div class="ion-padding">
					<ion-button color="primary" (click)="mergeContact()" expand="block">{{'Merge' |
						translate}}</ion-button>
				</div>
			</ion-footer>
		</ng-template>
	</ion-modal>
	<ion-infinite-scroll color="primary" threshold="30%" (ionInfinite)="loadData($event)"
		[disabled]="!pageConfig.infiniteScroll || pageConfig.isEndOfData">
		<ion-infinite-scroll-content loadingSpinner="dots"></ion-infinite-scroll-content>
	</ion-infinite-scroll>
</ion-content>